generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// TRANSCRIPTS
//
model Transcripts {
  id             String                       @id @default(uuid()) @map("id")
  org            String?
  title          String?
  url            String?
  transcript     String?                       @db.Text
  summary        String?                       @db.Text
  topics         String?                       @db.Text
  keywords       String?                       @db.Text
  transcriptDate DateTime?
  path           String?
  audioType      String?
  createdAt      DateTime                      @default(now())
  updatedAt      DateTime                      @updatedAt

  // RELAÇÕES (1:N)
  processes          Process[]                    @relation("ProcessTranscript")
  dialogs            TranscriptedDialog[]
  gdocs              TranscriptedGDoc[]
  words              TranscriptedWords[]
  diarizedWords      TranscriptedWordsDiarization[]
  transcriptsOpt     TranscriptsOpt[]
  wordsUnreliable    WordsUnreliable[]

  @@map("transcripts")
}

//
// PROCESS
//
model Process {
  id              String    @id @default(uuid())
  processNumber   String?   @unique
  reportDate      String?
  summary         String?   @db.Text
  questionAnswers String?   @db.Text
  transcriptId    String?
  deleted         Boolean?  @default(false)
  status          String?
  email           String?
  errorMessage    String?
  title           String?
  mediaName       String?
  observations    String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  transcript      Transcripts? @relation("ProcessTranscript", fields: [transcriptId], references: [id])

  users           ProcessUser[]
  statuses        ProcessStatus[]

  @@map("processes")
}

//
// DIALOGS
//
model Dialogs {
  id           String   @id @default(uuid())
  interlocutor String?
  paragrafo    String?
  startTime    String?
  startTimeSec String?
  videoId      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  file   Files? @relation(fields: [videoId], references: [videoId])
}

//
// DOCUMENTS
//
model Documents {
  id                String   @id @default(uuid())
  processNumber     String?
  documentURL       String?
  documentName      String?
  documentExtension String?
  documentOCR       String?
  summary           String?
  documentOCRTime   Float?
  email             String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  gdocs             TranscriptedGDoc[]
}

//
// FILES
//
model Files {
  id                   String   @id @default(uuid())
  videoId              String   @unique
  org                  String?
  videoPath            String?
  videoDurationSeconds Int?
  status               String?
  statusDescription    String?
  dateTime             DateTime?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  dialogs Dialogs[]

  @@map("files")
}

//
// PROCESS USER
//
model ProcessUser {
  id            String   @id @default(uuid())
  processNumber String?
  userEmail     String?
  hasPermission Boolean
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  process Process? @relation(fields: [processNumber], references: [processNumber])

  @@map("processUsers")
}

//
// PROCESS STATUS
//
model ProcessStatus {
  id               String   @id @default(uuid())
  processId        String?
  status           String?
  multimodalStatus String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  process Process? @relation(fields: [processId], references: [id])

  @@map("process_status")
}

//
// QUESTION
//
model Question {
  id        String   @id @default(uuid())
  text      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("questions")
}

//
// TASK TRANSCRIPT
//
model TaskTranscript {
  id            String   @id @default(uuid())
  name          String?
  initialPrompt String?
  uniquePrompt  String?
  jsonExpected  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("tasks_transcripts")
}

//
// TRANSCRIBED DIALOG
//
model TranscriptedDialog {
  id             String      @id @default(uuid())
  transcriptId   String
  sequence       Int?
  start          Float?
  end            Float?
  speaker        String?
  text           String?
  transcriptDate DateTime?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  transcriptRef Transcripts @relation(fields: [transcriptId], references: [id])

  @@map("transcriptedDialogs")
}

//
// TRANSCRIBED GDOC
//
model TranscriptedGDoc {
  id           String      @id @default(uuid())
  transcriptId String
  documentId   String?
  docUrl       String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  transcriptRef Transcripts @relation(fields: [transcriptId], references: [id])
  documentRef   Documents?  @relation(fields: [documentId], references: [id])

  @@map("transcriptedGDocs")
}

//
// TRANSCRIBED WORDS
//
model TranscriptedWords {
  id           String      @id @default(uuid())
  sequence     Int?
  transcriptId String
  word         String?
  startSeconds Float?
  endSeconds   Float?
  stopWord     Int?
  confidence   Float?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  transcriptRef Transcripts @relation(fields: [transcriptId], references: [id])

  @@map("transcriptedWords")
}

//
// TRANSCRIBED WORDS DIARIZATION
//
model TranscriptedWordsDiarization {
  id             String      @id @default(uuid())
  sequence       Int?
  transcriptId   String
  word           String?
  startSeconds   Float?
  endSeconds     Float?
  stopWord       Int?
  speaker        String?
  transcriptDate DateTime?
  confidence     Float?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  transcriptRef Transcripts @relation(fields: [transcriptId], references: [id])

  @@map("transcriptedWordsDiarization")
}

//
// TRANSCRIPTS OPT
//
model TranscriptsOpt {
  id                 String    @id @default(uuid())
  transcriptId       String
  processNumber      String?
  title              String?
  url                String?
  transcript         String?   @db.Text
  summary            String?   @db.Text
  topics             String?   @db.Text
  keywords           String?   @db.Text
  sentimentAnalysis  String?
  processType        String?
  email              String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  transcriptRef Transcripts @relation(fields: [transcriptId], references: [id])

  @@map("transcripts_opt")
}

//
// WORDS UNRELIABLE
//
model WordsUnreliable {
  id           String      @id @default(uuid())
  word         String?
  transcriptId String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  transcriptRef Transcripts? @relation(fields: [transcriptId], references: [id])
}
